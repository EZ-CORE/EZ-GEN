<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EZ-GEN - App Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .form-container {
            padding: 40px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #3b82f6;
        }
        
        .file-input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .file-input {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: border-color 0.3s ease;
            cursor: pointer;
        }
        
        .file-input:hover {
            border-color: #3b82f6;
        }
        
        .file-input input {
            display: none;
        }
        
        .generate-btn {
            width: 100%;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .generate-btn:hover {
            transform: translateY(-2px);
        }
        
        .generate-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            display: none;
        }
        
        .result.success {
            background: #d1fae5;
            border: 1px solid #10b981;
            color: #065f46;
        }
        
        .result.error {
            background: #fee2e2;
            border: 1px solid #ef4444;
            color: #991b1b;
        }
        
        .download-btn {
            background: #3b82f6;
            color: white;
            text-decoration: none;
            padding: 12px 20px;
            border-radius: 6px;
            margin-top: 10px;
            display: inline-block;
            font-weight: 600;
            transition: background-color 0.2s ease;
        }
        
        .download-btn:hover {
            background: #2563eb;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin-top: 20px;
        }
        
        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .feature {
            text-align: center;
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
        }
        
        .feature-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .console-container {
            margin-top: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #1a1a1a;
            height: 300px;
            overflow-y: auto;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #ffffff;
            display: none;
        }
        
        .console-container.active {
            display: block;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .log-entry.info {
            color: #60a5fa;
        }
        
        .log-entry.success {
            color: #34d399;
        }
        
        .log-entry.warning {
            color: #fbbf24;
        }
        
        .log-entry.error {
            color: #f87171;
        }
        
        .log-timestamp {
            color: #9ca3af;
            font-size: 10px;
        }
        
        .validation-error {
            background: #fee2e2;
            border: 1px solid #ef4444;
            color: #991b1b;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            white-space: pre-line;
        }
        
        .validation-warning {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            color: #92400e;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
        }
        
        .input-error {
            border-color: #ef4444 !important;
        }
        
        .toggle-console {
            background: #374151;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .toggle-console:hover {
            background: #4b5563;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ EZ-GEN</h1>
            <p>Generate Native Mobile Apps from Your Website</p>
        </div>
        
        <div class="form-container">
            <div class="features">
                <div class="feature">
                    <div class="feature-icon">üì±</div>
                    <h3>Cross-Platform</h3>
                    <p>Android & iOS ready</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">‚ö°</div>
                    <h3>Fast Generation</h3>
                    <p>Apps ready in minutes</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">üé®</div>
                    <h3>Customizable</h3>
                    <p>Your branding & assets</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">üì¶</div>
                    <h3>Store Ready</h3>
                    <p>APK/IPA for submission</p>
                </div>
            </div>
            
            <form id="appForm">
                <div class="form-group">
                    <label for="appName">App Name *</label>
                    <input type="text" id="appName" name="appName" required placeholder="My Awesome App">
                    <div id="appNameError" class="validation-error" style="display: none;"></div>
                </div>
                
                <div class="form-group">
                    <label for="websiteUrl">Website URL *</label>
                    <input type="url" id="websiteUrl" name="websiteUrl" required placeholder="https://your-website.com">
                    <div id="websiteUrlError" class="validation-error" style="display: none;"></div>
                    <div id="websiteUrlWarning" class="validation-warning" style="display: none;"></div>
                </div>
                
                <div class="form-group">
                    <label for="packageName">Package Name *</label>
                    <input type="text" id="packageName" name="packageName" required placeholder="com.yourcompany.appname">
                    <div id="packageNameError" class="validation-error" style="display: none;"></div>
                    <div id="packageNameWarning" class="validation-warning" style="display: none;"></div>
                    <div style="font-size: 0.8em; color: #666; margin-top: 5px;">
                        Must follow Java package naming (e.g., com.company.appname)
                    </div>
                </div>
                
                <div class="file-input-group">
                    <div class="file-input" onclick="document.getElementById('logo').click()">
                        <div>üì∑</div>
                        <div>Upload Logo</div>
                        <div style="font-size: 0.8em; color: #666; margin-top: 5px;">512x512 PNG recommended</div>
                        <input type="file" id="logo" name="logo" accept="image/*">
                    </div>
                    
                    <div class="file-input" onclick="document.getElementById('splash').click()">
                        <div>üñºÔ∏è</div>
                        <div>Upload Splash Screen</div>
                        <div style="font-size: 0.8em; color: #666; margin-top: 5px;">1080x1920 PNG recommended</div>
                        <input type="file" id="splash" name="splash" accept="image/*">
                    </div>
                </div>
                
                <button type="submit" class="generate-btn" id="generateBtn">
                    Generate Mobile App
                </button>
            </form>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Generating your mobile app...</p>
                <button class="toggle-console" onclick="toggleConsole()">
                    üìü Show Console
                </button>
                <div class="console-container" id="console">
                    <div id="consoleContent"></div>
                </div>
            </div>
            
            <div class="result" id="result"></div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        let socket = null;
        let sessionId = null;
        
        // Generate unique session ID for this user
        function generateSessionId() {
            return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        // Initialize session when page loads
        window.addEventListener('DOMContentLoaded', () => {
            sessionId = generateSessionId();
            console.log('Session ID:', sessionId);
        });
        
        // Initialize Socket.IO connection
        function initializeSocket() {
            if (socket) return;
            
            socket = io();
            
            socket.on('connect', () => {
                console.log('Connected to server');
                socket.emit('join-session', sessionId);
            });
            
            socket.on('log', (logEntry) => {
                addLogEntry(logEntry);
            });
            
            socket.on('session-logs', (logs) => {
                // Load existing logs for this session
                logs.forEach(log => addLogEntry(log));
            });
        }
        
        // Add log entry to console
        function addLogEntry(logEntry) {
            const consoleContent = document.getElementById('consoleContent');
            const logDiv = document.createElement('div');
            logDiv.className = `log-entry ${logEntry.type}`;
            
            const timestamp = new Date(logEntry.timestamp).toLocaleTimeString();
            logDiv.innerHTML = `<span class="log-timestamp">[${timestamp}]</span> ${logEntry.message}`;
            
            consoleContent.appendChild(logDiv);
            
            // Auto-scroll to bottom
            const console = document.getElementById('console');
            console.scrollTop = console.scrollHeight;
        }
        
        // Toggle console visibility
        function toggleConsole() {
            const console = document.getElementById('console');
            const button = document.querySelector('.toggle-console');
            
            if (console.classList.contains('active')) {
                console.classList.remove('active');
                button.textContent = 'üìü Show Console';
            } else {
                console.classList.add('active');
                button.textContent = 'üìü Hide Console';
            }
        }
        
        // Input validation functions
        function validateAppName(appName) {
            const errorDiv = document.getElementById('appNameError');
            const input = document.getElementById('appName');
            
            if (!appName || appName.length < 2 || appName.length > 50) {
                showError(input, errorDiv, 'App name must be between 2 and 50 characters');
                return false;
            }
            
            if (!/^[a-zA-Z0-9\s\-_]+$/.test(appName)) {
                showError(input, errorDiv, 'App name can only contain letters, numbers, spaces, hyphens, and underscores');
                return false;
            }
            
            hideError(input, errorDiv);
            return true;
        }
        
        function validateWebsiteUrl(url) {
            const errorDiv = document.getElementById('websiteUrlError');
            const warningDiv = document.getElementById('websiteUrlWarning');
            const input = document.getElementById('websiteUrl');
            
            // Check for empty or invalid input
            if (!url || url.trim() === '') {
                showError(input, errorDiv, 'Website URL is required');
                return false;
            }
            
            // Check for basic invalid characters that shouldn't be in URLs
            if (/['"`\s]/.test(url)) {
                showError(input, errorDiv, 'Website URL contains invalid characters (quotes, spaces not allowed)');
                return false;
            }
            
            // Check for proper URL format (must have :// after protocol)
            if (/^https?:[^\/]/.test(url)) {
                showError(input, errorDiv, 'Invalid URL format. Use https:// or http:// (e.g., https://example.com)');
                return false;
            }
            
            try {
                const urlObj = new URL(url);
                
                if (!['http:', 'https:'].includes(urlObj.protocol)) {
                    showError(input, errorDiv, 'Website URL must use HTTP or HTTPS protocol');
                    return false;
                }
                
                if (!urlObj.hostname || urlObj.hostname.length < 3) {
                    showError(input, errorDiv, 'Website URL must have a valid hostname');
                    return false;
                }
                
                // Check for localhost (special case)
                if (urlObj.hostname === 'localhost' || urlObj.hostname === '127.0.0.1') {
                    hideError(input, errorDiv);
                    showWarning(warningDiv, 'Warning: Using localhost URL - this will only work for local testing');
                    return true;
                }
                
                // Check for valid domain format (must have at least one dot for TLD)
                if (!urlObj.hostname.includes('.')) {
                    showError(input, errorDiv, 'Website URL must have a valid domain with extension (e.g., example.com)');
                    return false;
                }
                
                // Check for valid hostname format (basic domain validation)
                const hostnameRegex = /^[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;
                if (!hostnameRegex.test(urlObj.hostname)) {
                    showError(input, errorDiv, 'Website URL must have a valid domain name (e.g., example.com)');
                    return false;
                }
                
                // Check for valid TLD (must end with at least 2 letter extension)
                const parts = urlObj.hostname.split('.');
                const tld = parts[parts.length - 1];
                if (!/^[a-zA-Z]{2,}$/.test(tld)) {
                    showError(input, errorDiv, 'Website URL must have a valid domain extension (e.g., .com, .org, .net)');
                    return false;
                }
                
                hideError(input, errorDiv);
                hideWarning(warningDiv);
                return true;
            } catch (error) {
                showError(input, errorDiv, 'Invalid URL format. Please enter a valid website URL (e.g., https://example.com)');
                return false;
            }
        }
        
        function validatePackageName(packageName) {
            const errorDiv = document.getElementById('packageNameError');
            const warningDiv = document.getElementById('packageNameWarning');
            const input = document.getElementById('packageName');
            
            const packageRegex = /^[a-z][a-z0-9_]*(\.[a-z][a-z0-9_]*)+$/;
            
            if (!packageRegex.test(packageName)) {
                showError(input, errorDiv, 
                    'Package name must follow Java package naming conventions:\n' +
                    '‚Ä¢ Must start with a lowercase letter\n' +
                    '‚Ä¢ Can contain lowercase letters, numbers, and underscores\n' +
                    '‚Ä¢ Must have at least one dot (e.g., com.company.appname)\n' +
                    '‚Ä¢ Each part must start with a letter\n' +
                    'Example: com.yourcompany.appname'
                );
                return false;
            }
            
            const parts = packageName.split('.');
            if (parts.length < 3) {
                showError(input, errorDiv, 'Package name must have exactly 3 parts separated by dots (e.g., com.company.appname)');
                return false;
            }
            
            if (parts.length > 5) {
                showError(input, errorDiv, 'Package name should not have more than 5 parts for simplicity');
                return false;
            }
            
            hideError(input, errorDiv);
            hideWarning(warningDiv);
            
            return true;
        }
        
        function showError(input, errorDiv, message) {
            input.classList.add('input-error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }
        
        function hideError(input, errorDiv) {
            input.classList.remove('input-error');
            errorDiv.style.display = 'none';
        }
        
        function showWarning(warningDiv, message) {
            warningDiv.textContent = message;
            warningDiv.style.display = 'block';
        }
        
        function hideWarning(warningDiv) {
            warningDiv.style.display = 'none';
        }
        
        // Real-time validation
        document.getElementById('appName').addEventListener('input', (e) => {
            validateAppName(e.target.value);
        });
        
        document.getElementById('websiteUrl').addEventListener('input', (e) => {
            validateWebsiteUrl(e.target.value);
        });
        
        document.getElementById('packageName').addEventListener('input', (e) => {
            validatePackageName(e.target.value);
        });
        
        // Form submission
        document.getElementById('appForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const appName = document.getElementById('appName').value;
            const websiteUrl = document.getElementById('websiteUrl').value;
            const packageName = document.getElementById('packageName').value;
            
            // Validate all inputs
            const isAppNameValid = validateAppName(appName);
            const isUrlValid = validateWebsiteUrl(websiteUrl);
            const isPackageValid = validatePackageName(packageName);
            
            if (!isAppNameValid || !isUrlValid || !isPackageValid) {
                alert('Please fix the validation errors before submitting');
                return;
            }
            
            // Initialize socket connection
            initializeSocket();
            
            const formData = new FormData();
            formData.append('appName', appName);
            formData.append('websiteUrl', websiteUrl);
            formData.append('packageName', packageName);
            formData.append('sessionId', sessionId);
            
            const logo = document.getElementById('logo').files[0];
            const splash = document.getElementById('splash').files[0];
            
            if (logo) formData.append('logo', logo);
            if (splash) formData.append('splash', splash);
            
            // Show loading and console
            document.getElementById('generateBtn').disabled = true;
            document.getElementById('loading').style.display = 'block';
            document.getElementById('result').style.display = 'none';
            
            // Auto-show console during generation
            const console = document.getElementById('console');
            const toggleButton = document.querySelector('.toggle-console');
            console.classList.add('active');
            toggleButton.textContent = 'üìü Hide Console';
            
            try {
                const response = await fetch('/api/generate-app', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                // Hide loading
                document.getElementById('loading').style.display = 'none';
                document.getElementById('generateBtn').disabled = false;
                
                const resultDiv = document.getElementById('result');
                resultDiv.style.display = 'block';
                
                if (result.success) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <h3>üéâ Play Store-Ready App Generated Successfully!</h3>
                        <p>${result.message}</p>
                        <div style="margin-top: 20px;">
                            <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #3b82f6;">
                                <h4 style="margin: 0 0 10px 0; color: #1e40af;">üè™ For Google Play Store</h4>
                                <a href="${result.aabDownloadUrl}" class="download-btn" download style="background: #059669; margin-right: 10px;">
                                    üì¶ Download AAB (Play Store)
                                </a>
                                <a href="${result.guideUrl}" class="download-btn" download style="background: #7c3aed;">
                                    üìã Submission Guide
                                </a>
                            </div>
                            <div style="background: #fffbeb; padding: 15px; border-radius: 8px; border-left: 4px solid #f59e0b;">
                                <h4 style="margin: 0 0 10px 0; color: #d97706;">üîß For Testing & Development</h4>
                                <a href="${result.apkDownloadUrl}" class="download-btn" download style="background: #3b82f6; margin-right: 10px;">
                                    üîß Download Debug APK
                                </a>
                                <a href="${result.releaseApkDownloadUrl}" class="download-btn" download style="background: #dc2626; margin-right: 10px;">
                                    üöÄ Download Release APK
                                </a>
                                <a href="${result.downloadUrl}" class="download-btn" download style="background: #6b7280;">
                                    üìÅ Download Project
                                </a>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding: 12px; background: #ecfdf5; border-radius: 6px; border: 1px solid #bbf7d0;">
                            <p style="margin: 0; font-size: 0.9em; color: #166534;">
                                <strong>‚úÖ Ready for Play Store!</strong> Your app includes signed release builds, Android App Bundle (AAB), and a complete submission guide.
                            </p>
                        </div>
                        <div style="margin-top: 10px; font-size: 0.85em; color: #6b7280;">
                            <p style="margin: 5px 0;"><strong>üì¶ AAB:</strong> Upload this to Google Play Console (recommended format)</p>
                            <p style="margin: 5px 0;"><strong>üîß Debug APK:</strong> Install on your device for testing (unsigned, development only)</p>
                            <p style="margin: 5px 0;"><strong>üöÄ Release APK:</strong> Signed, production-ready APK for sideloading</p>
                            <p style="margin: 5px 0;"><strong>üìã Guide:</strong> Step-by-step Play Store submission instructions</p>
                        </div>
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `
                        <h3>‚ùå Generation Failed</h3>
                        <p>${result.message}</p>
                    `;
                }
            } catch (error) {
                // Hide loading
                document.getElementById('loading').style.display = 'none';
                document.getElementById('generateBtn').disabled = false;
                
                const resultDiv = document.getElementById('result');
                resultDiv.style.display = 'block';
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <h3>‚ùå Network Error</h3>
                    <p>Failed to connect to the server. Please try again.</p>
                `;
            }
        });
        
        // File input feedback
        document.getElementById('logo').addEventListener('change', function(e) {
            const parent = e.target.closest('.file-input');
            if (e.target.files[0]) {
                parent.style.borderColor = '#10b981';
                parent.querySelector('div:nth-child(2)').textContent = '‚úì Logo Selected';
            }
        });
        
        document.getElementById('splash').addEventListener('change', function(e) {
            const parent = e.target.closest('.file-input');
            if (e.target.files[0]) {
                parent.style.borderColor = '#10b981';
                parent.querySelector('div:nth-child(2)').textContent = '‚úì Splash Selected';
            }
        });
    </script>
</body>
</html>
